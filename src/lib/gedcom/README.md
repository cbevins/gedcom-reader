# gedcom Subpackage

The **gedcom** subpackage provides the bridge between a GEDCOM file (as produced by ANcestry.com  or RootsMagic) and any Nodejs or browser clients that want to access that information.  This is basically a two step process:

1. run the **write_gedcomData.js** script to generate a Javascript data file from a GEDCOM text file,
2. import the Javascript data file into your client code.

## 1 Create Javascript Data File from GEDCOM

The script file **write_gedcomData.js** reads the **../tmp/Ancestry.ged** and **../RootsMagic.ged** GEDCOM text files and generates corresponding **_gedcomDataAncestry.js** and **_gedcomDataRootsMagic.js** Javascript data files:

```bash
node write_gedcomdata.js
```
which logs:

```bash
write_gedcomData.js ...
    GEDCOM file          : '../tmp/Ancestry.ged' has 94170 records
        file2JsonArray() :  107 msec
        writeFile()      :   97 msec
        created file     : '_gedcomDataAncestry.js'
    GEDCOM file          : '../tmp/RootsMagic.ged' has 131971 records
        file2JsonArray() :  126 msec
        writeFile()      :  119 msec
        created file     : '_gedcomDataRootsMagic.js'
```

Each generated file contains a single (longish) statement:

```js
// auto-generated by write_gedcomData.js on 7/11/2024, 10:21:15 AM
export const _gedcomData = [
    ...
]
```

## 2 Import _gedcomData and Create a **Gedcom** Instance

```js
    import { GedcomReader } from './GedcomReader.js'
    // import { _gedcomData } from './_gedcomAncestry.js'
    import { _gedcomData } from './_gedcomDataRootsMagic.js'

    // Read the GEDCOM data into a Gedcom instance
    const reader = new GedcomReader(_gedcomData)
    const gedcom = reader.gedcom()
    
    // Access content of interest from the Gedcom
    const source = gedcom.findFirstContent('', ['HEAD','SOUR','NAME'])
    const created = gedcom.findFirstContent('', ['HEAD','DATE'])

```

## Files

### GedcomRecord.js Defines the GedcomRecord Class

GedcomRecord class instances contain a single record of a GEDCOM file.  Because the GEDCOM file represents a nested file structure, the GedcomRecord class maintains references to its parent record and all its child records.

#### Methods

- **context()** returns this instance's record type lineage as an array of strings

- **content()** return this GedcomRecord's content as a (possibly empty) string

- **level()** returns this instance's nesting level as a base-0 integer

- **lineNo()** returns this instance's line number in the original GEDCOM file

- **lines()** returns the number of lines this record occupied in the original GEDCOM file

- **parent()** returns a reference to this instance's parent GedcomRecord

- **subs()** returns an array of references to this instance's child GedcomRecord

- **type()** returns this instance's record type string ('INDI', 'NAME', 'DATE', etc)

### Gedcom.js Defines the Gedcom Class

The Gedcom class holds _gedcomData.js data in a structure that is more readily searched by clients. (The _gedcomData.js file itself is generated by write_gedcomData.js from a GEDCOM text file from Ancestry.com or RootsMagic).

Gedcom holds GedcomRecords in a Map() object whose key is the top level 0 record type ('FAM', 'INDI', '_PLAC', etc), and whose entries are another Map() of all the key's toplevel GedcomRecords with their nested GedcomRecord subrecords.
 
#### Methods

- **contexts()** returns an array of [context, count] arrays sorted by context

- **findAllContent(key, context, missing='')** finds ALL GedcomRecords matching the *type* and *context* starting at the top level and returns their content strings in an array

- **findAllRecords(key, context)** finds ALL GedcomRecords matching the *type* and *context* starting at the top level and returns their GedcomRecord references in an array

- **findFirstContent(key, context, missing='')** finds FIRST GedcomRecords matching the *type* and *context* starting at the top level and returns its contents as a string

- **findFirstRecord(key, context)** finds FIRST GedcomRecords matching the *type* and *context* starting at the top level and returns its reference or NULL

- **findHead(type, key)** returns reference to the Level 0 GedcomRecord with *key*

- **topLevel()** returns a reference to the Map() of top-level (Level 0) GedcomRecord instances

- **topLevelCounts()** returns array of [type0, count] arrays of all Level 0 record types

- **topLevelRecordsFor(key)** returns a reference to the Map() of all GedcomRecord instances for top-level *key*

### GedcomReader.js Defins the GedcomReader Class

#### Methods

- **GedcomReader(fileArray)** parses the *fileArray* of GEDCOM records into a GedcomRecords instance.

- **gedcom()** returns the GedcomRecords instance created by the constructor

- **lines()** returns the *fileArray* passed to the constructor

- **messages()** returns a (possibly empoty) array of warning and error messages generated while parsing the GEDCOM file

